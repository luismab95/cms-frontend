@if(user){
<div class="flex w-full flex-col">
    <!-- View mode -->
    @if (!editMode) {
    <!-- Header -->
    <div class="relative h-40 w-full bg-accent-100 px-8 dark:bg-accent-700 sm:h-48 sm:px-12">
        <!-- Close button -->
        <div class="mx-auto flex w-full max-w-3xl items-center justify-end pt-6">
            <a mat-icon-button [matTooltip]="'Cerrar'" [mat-dialog-close]="false">
                <mat-icon class="text-dark" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
            </a>
        </div>
    </div>

    <!-- User -->
    <div class="relative flex flex-auto flex-col items-center p-6 pt-0 sm:p-12 sm:pt-0">
        <div class="w-full max-w-3xl">
            <!-- Avatar and actions -->
            <div class="-mt-16 flex flex-auto items-end">
                <!-- Avatar -->
                <div
                    class="ring-bg-card flex h-32 w-32 items-center justify-center overflow-hidden rounded-full ring-4">
                    <div
                        class="flex h-full w-full items-center justify-center overflow-hidden rounded bg-gray-200 text-8xl font-bold uppercase leading-none text-gray-600 dark:bg-gray-700 dark:text-gray-200">
                        {{ user.firstname.charAt(0) }}{{ user.lastname.charAt(0) }}
                    </div>
                </div>
                <!-- Actions -->
                <div class="mb-1 ml-auto flex items-center">
                    <button mat-stroked-button (click)="toggleEditMode(true)">
                        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:pencil-square'"></mat-icon>
                        <span class="ml-2">Editar</span>
                    </button>
                </div>
            </div>

            <!-- Name -->
            <div [matTooltip]="user.firstname + ' ' +user.lastname" class="mt-3 truncate text-4xl font-bold">
                {{ user.firstname }} {{user.lastname }}
            </div>

            <div class="mt-2 flex flex-wrap items-center">
                <!-- Status -->
                @if (user.status) {
                <div
                    class="mb-3 mr-3 flex items-center justify-center rounded-full bg-primary-400 px-3 py-1 leading-normal text-white dark:bg-gray-700 dark:text-gray-300">
                    <span class="whitespace-nowrap text-sm font-medium">Activo</span>
                </div>
                }
                @if (!user.status) {
                <div
                    class="mb-3 mr-3 flex items-center justify-center rounded-full bg-gray-400 px-3 py-1 leading-normal text-white dark:bg-gray-700 dark:text-gray-300">
                    <span class="whitespace-nowrap text-sm font-medium">Inactivo</span>
                </div> }
            </div>

            <div class="mt-4 flex flex-col space-y-8 border-t pt-6">
                <!-- Email -->
                <div class="flex sm:items-center">
                    <mat-icon [svgIcon]="'heroicons_outline:envelope'"></mat-icon>
                    <div class="ml-6 leading-6">
                        {{ user.email }}
                    </div>
                </div>
                <!-- Role-->
                <div class="flex sm:items-center">
                    <mat-icon [svgIcon]="'heroicons_outline:identification'"></mat-icon>
                    <div class="ml-6 leading-6">
                        {{getRole(user.roleId) }}
                    </div>
                </div>

                <!-- Bloqued-->
                <div class="flex sm:items-center">
                    <mat-icon [svgIcon]="'heroicons_outline:no-symbol'"></mat-icon>
                    <div class="ml-6 leading-6">
                        {{ user.bloqued ? 'Bloqueado': 'Desbloqueado' }}
                    </div>
                </div>
            </div>


        </div>
    </div>
    }

    <!-- Edit mode -->
    @if (editMode) {
    <!-- Header -->
    <div class="relative h-40 w-full bg-accent-100 px-8 dark:bg-accent-700 sm:h-48 sm:px-12">
        <!-- Close button -->
        <div class="mx-auto flex w-full max-w-3xl items-center justify-end pt-6">
            <a mat-icon-button [matTooltip]="'Cerrar'" [mat-dialog-close]="false">
                <mat-icon class="text-dark" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
            </a>
        </div>
    </div>

    <!-- User form -->
    <div class="relative flex flex-auto flex-col items-center px-6 sm:px-12">
        <div class="w-full max-w-3xl">
            <ng-container *ngTemplateOutlet="userTemplateForm;"></ng-container>
        </div>
    </div>
    <!-- Actions -->
    <div class="absolute bottom-0 left-0 w-full">
        <div class="flex items-center border-t bg-gray-50 p-4 dark:bg-transparent">
            <!-- Delete -->
            <button mat-button [color]="user.status ?'warn' : 'primary'" (click)="toggleUser()">
                @if (!userForm.disabled) {
                <span> @if(!user.status){
                    Activar
                    }@else {
                    Inactivar
                    }</span>
                }
                @if (userForm.disabled) {
                <mat-progress-spinner [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
                }
            </button>

            <!-- Cancel -->
            <button class="ml-auto" mat-button (click)="toggleEditMode(false)">
                Cancelar
            </button>
            <!-- Save -->
            <button class="ml-2" mat-flat-button type="button" [color]="'primary'" [disabled]="userForm.disabled"
                (click)="updateUser()">
                @if (!userForm.disabled) {
                <span> Guardar</span>
                }
                @if (userForm.disabled) {
                <mat-progress-spinner [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
                }
            </button>

        </div>
    </div>
    }
</div>
}@else {
<!-- Header -->
<div class="relative h-40 w-full bg-accent-100 px-8 dark:bg-accent-700 sm:h-48 sm:px-12">
    <!-- Cerrar button -->
    <div class="mx-auto flex w-full max-w-3xl items-center justify-end pt-6">
        <a mat-icon-button [matTooltip]="'Cerrar'" [mat-dialog-close]="false">
            <mat-icon class="text-dark" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
        </a>
    </div>
</div>

<!-- User form -->
<div class="relative flex flex-auto flex-col items-center px-6 sm:px-12">
    <div class="w-full max-w-3xl">
        <ng-container *ngTemplateOutlet="userTemplateForm;"></ng-container>
    </div>
</div>

<!-- Actions -->
<div class="absolute bottom-0 w-full left-0">
    <div class="flex items-center border-t bg-gray-50 p-4 dark:bg-transparent">
        <!-- Cancel -->
        <button class="ml-auto" mat-button [mat-dialog-close]="false">
            Cancelar
        </button>
        <!-- Save -->
        <button class="ml-2" mat-flat-button type="button" [color]="'primary'" [disabled]="userForm.disabled"
            (click)="newUser()">
            @if (!userForm.disabled) {
            <span> Guardar</span>
            }
            @if (userForm.disabled) {
            <mat-progress-spinner [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
            }
        </button>
    </div>
</div>

}

<ng-template #userTemplateForm>
    <form [formGroup]="userForm">
        <!-- Avatar -->
        <div class="-mt-16 flex flex-auto items-end">
            <div
                class="ring-bg-card relative flex h-32 w-32 items-center justify-center overflow-hidden rounded-full ring-4">
                <!-- Image/Letter -->
                <div
                    class="flex h-full w-full items-center justify-center overflow-hidden rounded bg-gray-200 text-8xl font-bold uppercase leading-none text-gray-600 dark:bg-gray-700 dark:text-gray-200">
                    @if(user){
                    {{ user.firstname.charAt(0) }}{{ user.lastname.charAt(0) }}
                    }
                </div>
            </div>
        </div>

        <!-- Title -->
        <div class="mt-3 truncate text-4xl font-bold">
            @if(user){
            Editar usuario
            }@else {
            Agregar usuario
            }
        </div>

        <!-- Name -->
        <div class="mt-8">
            <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                <mat-label>Nombres</mat-label>
                <mat-icon matPrefix class="hidden icon-size-5 sm:flex"
                    [svgIcon]="'heroicons_outline:pencil'"></mat-icon>
                <input matInput [formControlName]="'firstname'" [placeholder]="'Nombres'" [spellcheck]="false" />
                @if (userForm.get('firstname').hasError('required')) {
                <mat-error>Se requiere nombres. </mat-error>
                }
            </mat-form-field>
        </div>

        <!-- Lastname -->
        <div class="mt-8">
            <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                <mat-label>Apellidos</mat-label>
                <mat-icon matPrefix class="hidden icon-size-5 sm:flex"
                    [svgIcon]="'heroicons_outline:pencil'"></mat-icon>
                <input matInput [formControlName]="'lastname'" [placeholder]="'Apellidos'" [spellcheck]="false" />
                @if (userForm.get('lastname').hasError('required')) {
                <mat-error>Se requiere apellidos. </mat-error>
                }
            </mat-form-field>
        </div>

        <!-- Email -->
        <div class="mt-8">
            <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                <mat-label>Correo electrónico</mat-label>
                <mat-icon matPrefix class="hidden icon-size-5 sm:flex"
                    [svgIcon]="'heroicons_outline:envelope'"></mat-icon>
                <input matInput [formControlName]="'email'" [placeholder]="'mail@example.com'" [spellcheck]="false" />
                @if (userForm.get('email').hasError('required')) {
                <mat-error>Se requiere dirección de correo electrónico. </mat-error>
                }
                @if (userForm.get('email').hasError('email')) {
                <mat-error>
                    Por favor, introduce una dirección de correo electrónico válida.
                </mat-error>
                }
            </mat-form-field>
        </div>

        <!-- Role -->
        <div class="mt-8">
            <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                <mat-label>Rol</mat-label>
                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:identification'" matPrefix></mat-icon>
                <mat-select [panelClass]="'w-72 min-w-72 max-w-72 h-auto max-h-none'" [formControlName]="'roleId'"
                    disableOptionCentering #roleSelect="matSelect">
                    <mat-select-trigger class="text-md">
                        <span class="ml-1 font-medium">
                            @if(user){
                            {{
                            getRole(user.roleId) | titlecase
                            }}
                            }@else {
                            {{getRole(userForm.get('roleId').value) | titlecase}}
                            }
                        </span>
                    </mat-select-trigger>
                    @for (role of roles; track role) {
                    <mat-option class="h-auto py-4 leading-none" [value]="role.id">
                        <div class="font-medium">
                            {{ role.name }}
                        </div>
                        <div class="text-secondary mt-1.5 whitespace-normal text-sm leading-normal">
                            {{ role.description }}
                        </div>
                    </mat-option>
                    }
                </mat-select>
                @if (userForm.get('roleId').hasError('required')) {
                <mat-error>Se requiere rol. </mat-error>
                }
            </mat-form-field>
        </div>

        <!-- Bloqued -->
        @if(user){
        <div class="mt-8">
            <div class="flex items-center justify-between">
                <div class="flex-auto cursor-pointer" (click)="bloqued.toggle()">
                    <div class="font-medium leading-6">{{user.bloqued ? 'Desbloquear' : 'Bloquear'}}</div>
                    <div class="text-secondary text-md">
                        Desbloquea/Bloquea al usuario.
                    </div>
                </div>
                <mat-slide-toggle class="ml-2" [color]="'primary'" [formControlName]="'bloqued'" #bloqued>
                </mat-slide-toggle>
            </div>
        </div>
        }
    </form>
</ng-template>